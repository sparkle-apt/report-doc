<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial &mdash; Report 0.1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Rule Reporter" href="rule_reporter.html" />
    <link rel="prev" title="Report - A Tool for Strategy Performance Evaluation and Report" href="include_readme.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Report
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="include_readme.html">Report - A Tool for Strategy Performance Evaluation and Report</a><ul>
<li class="toctree-l2"><a class="reference internal" href="include_readme.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="include_readme.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="include_readme.html#communication">Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="include_readme.html#releases-and-contributing">Releases and Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="include_readme.html#the-team">The Team</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-usage">Basic usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-usage">Advanced usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#user-defined-metrics">User-defined metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#by-group-analysis">By-group analysis</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rule_reporter.html">Rule Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Metrics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">CHANGELOG</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v0-1-0">v0.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#new-feature">New Feature</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html#improvement">Improvement</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Report</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline"></a></h1>
<p>In this tutorial, we will walk you through basic usage as well as advanced ones of the tool.
There are also detailed examples in <cite>examples</cite> directory. These are good pointers to start with.</p>
<div class="section" id="basic-usage">
<h2>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline"></a></h2>
<p>First thing first, an input <em>table</em> should be prepared and fed into the tool. The table is expected to be
order level, namely, one row for each order. It contains for each order several columns, including
order amount, sample weight (optional), decline decision (equal 1 if decline and 0 otherwise), and others
required to compute metrics. For instance, if a user needs to compute NTL metric, the table should contain a
column of NTL.</p>
<p>Suppose the prepared table contains order amount column named <code class="docutils literal notranslate"><span class="pre">gmv</span></code>, sample weight column named <code class="docutils literal notranslate"><span class="pre">weight</span></code>,
NTL column named <code class="docutils literal notranslate"><span class="pre">loss2</span></code>, and decline decision columns for two rules named
<code class="docutils literal notranslate"><span class="pre">eu_fraud_online_whitepages_general_reject</span></code> and <code class="docutils literal notranslate"><span class="pre">other_reject</span></code>. Then, to use <code class="xref py py-class docutils literal notranslate"><span class="pre">RuleReporter</span></code> to evalute
the NTL accuracy and NTL coverage of these two rules, one can simply follow the code snippet below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reporter</span> <span class="o">=</span> <span class="n">RuleReporter</span><span class="p">()</span>

<span class="n">metric_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ntl&#39;</span><span class="p">]</span>
<span class="n">amt_name</span> <span class="o">=</span> <span class="s1">&#39;gmv&#39;</span>
<span class="n">weight_name</span> <span class="o">=</span> <span class="s1">&#39;weight&#39;</span>
<span class="n">benchmark_name</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">dcl_dcsn_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;eu_fraud_online_whitepages_general_reject&#39;</span><span class="p">,</span> <span class="s1">&#39;other_reject&#39;</span><span class="p">]</span>
<span class="n">col_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ntl&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;base_name&#39;</span><span class="p">:</span> <span class="s1">&#39;loss2&#39;</span> <span class="c1"># need to tell RuleReporter which column is ntl</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">reporter</span> <span class="o">=</span> <span class="n">RuleReporter</span><span class="p">()</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">raw</span><span class="p">,</span> <span class="n">amt_name</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">metric_names</span><span class="p">,</span> <span class="n">weight_name</span><span class="o">=</span><span class="n">weight_name</span><span class="p">,</span>
    <span class="n">dcl_dcsn_names</span><span class="o">=</span><span class="n">dcl_dcsn_names</span><span class="p">,</span>
    <span class="n">benchmark_name</span><span class="o">=</span><span class="n">benchmark_name</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">col_names</span><span class="o">=</span><span class="n">col_names</span>
<span class="p">)</span>
</pre></div>
</div>
<p>One can view the result using <code class="docutils literal notranslate"><span class="pre">res.head()</span></code> or directly <code class="docutils literal notranslate"><span class="pre">res</span></code> in notebook. The default display may be a bit
boring, and hard to read. The tool provides a method to decorate the display as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reporter</span><span class="o">.</span><span class="n">decorate</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<p>With highlighting and borders and other stuff, it would be easier to track performance of rules.</p>
<p>But this is not the end of it. As some rules use model score as input, it is often frustrating to
find a good cutoff that maximizes performance of the rule. To mitigate this issue, the tool provides
a functionality that allows one evaluates rules with different parameterization at the same time.</p>
<p>To make this happen, one needs to type two lines to define a model strategy, as shown in <code class="docutils literal notranslate"><span class="pre">hrm_rule</span></code>. Note how
cutoffs that are to be adjusted are specified. Next, one generates <code class="docutils literal notranslate"><span class="pre">rule_params</span></code> containing all
combinations of cutoffs to evaluate. Note also that compared to the previous example, we set a benchmark by
providing <code class="docutils literal notranslate"><span class="pre">eu_fraud_online_whitepages_general_reject</span></code> to <code class="docutils literal notranslate"><span class="pre">benchmark_name</span></code>. With this setting, the rule
reporter will not only evalute metrics of each rule, but also compute lift of rules with respect to the
benchmark rule.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hrm_rule</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">score_cutoff</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">amt_cutoff</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">score_cutoff</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;gmv&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">amt_cutoff</span><span class="p">)</span>

<span class="n">reporter</span> <span class="o">=</span> <span class="n">RuleReporter</span><span class="p">()</span>

<span class="n">metric_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ntl&#39;</span><span class="p">]</span>
<span class="n">amt_name</span> <span class="o">=</span> <span class="s1">&#39;gmv&#39;</span>
<span class="n">weight_name</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">benchmark_name</span> <span class="o">=</span> <span class="s1">&#39;eu_fraud_online_whitepages_general_reject&#39;</span>
<span class="n">dcl_dcsn_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;eu_fraud_online_whitepages_general_reject&#39;</span><span class="p">]</span>
<span class="n">col_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ntl&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;base_name&#39;</span><span class="p">:</span> <span class="s1">&#39;loss2&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">rules</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;hrm_rule&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;rule&#39;</span><span class="p">:</span> <span class="n">hrm_rule</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># set values you wanna try</span>
<span class="n">rule_params</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">score_cutoffs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
<span class="n">amt_cutoffs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
<span class="k">for</span> <span class="n">score_cutoff</span><span class="p">,</span> <span class="n">amt_cutoff</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">score_cutoffs</span><span class="p">,</span> <span class="n">amt_cutoffs</span><span class="p">):</span>
    <span class="n">rule_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s1">&#39;hrm_rule&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;score_cutoff&#39;</span><span class="p">:</span> <span class="n">score_cutoff</span><span class="p">,</span>
                <span class="s1">&#39;amt_cutoff&#39;</span><span class="p">:</span> <span class="n">amt_cutoff</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">raw</span><span class="p">,</span> <span class="n">amt_name</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">rule_params</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">metric_names</span><span class="p">,</span>
    <span class="n">weight_name</span><span class="o">=</span><span class="n">weight_name</span><span class="p">,</span> <span class="n">dcl_dcsn_names</span><span class="o">=</span><span class="n">dcl_dcsn_names</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">rules</span><span class="p">,</span>
    <span class="n">benchmark_name</span><span class="o">=</span><span class="n">benchmark_name</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">col_names</span><span class="o">=</span><span class="n">col_names</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="advanced-usage">
<h2>Advanced usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline"></a></h2>
<div class="section" id="user-defined-metrics">
<h3>User-defined metrics<a class="headerlink" href="#user-defined-metrics" title="Permalink to this headline"></a></h3>
<p>Understanding that evaluating rule performance requires appropriate and comprehensive metrics which are subject to
refinement, we provide both off-the-shelf commonly used metrics and easy interface to add customized ones.</p>
<p>Metrics are Python Classes in the tool. All existing metrics can be found in <a class="reference internal" href="metrics.html#module-report.metrics" title="report.metrics"><code class="xref py py-mod docutils literal notranslate"><span class="pre">report.metrics</span></code></a>
and include GMV, NTL, P2D0, etc. They all inherit <a class="reference internal" href="metrics.html#report.metrics.BaseMetric" title="report.metrics.BaseMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">report.metrics.BaseMetric</span></code></a>. Before struggling
with implementing your own metric, please first take a look at existing ones and only take the effort if
none satisfies your need.</p>
<p>To implement one’s own metric, the tool provides several ways depending on how customized the metric is. If its
computation is the same as NTL but with different definition of loss, one can simply register the metric as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reporter</span> <span class="o">=</span> <span class="n">RuleReporter</span><span class="p">()</span>
<span class="n">reporter</span><span class="o">.</span><span class="n">register_metric</span><span class="p">(</span><span class="s1">&#39;new_loss&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">NTL</span><span class="p">)</span>
</pre></div>
</div>
<p>This tells <code class="xref py py-class docutils literal notranslate"><span class="pre">reporter.RuleReporter</span></code> that there is a new metric called <code class="docutils literal notranslate"><span class="pre">new_loss</span></code>.</p>
<p>To evaluate rules with the new metric, one needs to tell which column in the input table
indicates <code class="docutils literal notranslate"><span class="pre">new_loss</span></code> (support that’s <code class="docutils literal notranslate"><span class="pre">new_ntl</span></code>), and calls <code class="docutils literal notranslate"><span class="pre">reporter</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">col_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;new_loss&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;base_name&#39;</span><span class="p">:</span> <span class="s1">&#39;new_ntl&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">raw</span><span class="p">,</span> <span class="n">amt_name</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">rule_params</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">metric_names</span><span class="p">,</span>
    <span class="n">weight_name</span><span class="o">=</span><span class="n">weight_name</span><span class="p">,</span> <span class="n">dcl_dcsn_names</span><span class="o">=</span><span class="n">dcl_dcsn_names</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">rules</span><span class="p">,</span>
    <span class="n">benchmark_name</span><span class="o">=</span><span class="n">benchmark_name</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">col_names</span><span class="o">=</span><span class="n">col_names</span>
<span class="p">)</span>
</pre></div>
</div>
<p>However, if the logic of the new metric is different from that of NTL, but they differ only in the denominators when
computing accuracy, coverage, and impact, one can follow the previous example with only one change. Namely, one needs
to specify which columns are used for denominators.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reporter</span> <span class="o">=</span> <span class="n">RuleReporter</span><span class="p">()</span>
<span class="n">reporter</span><span class="o">.</span><span class="n">register_metric</span><span class="p">(</span><span class="s1">&#39;new_loss&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">NTL</span><span class="p">)</span>

<span class="n">col_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;new_loss&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;base_name&#39;</span><span class="p">:</span> <span class="s1">&#39;new_ntl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;acc_denom_name&#39;</span><span class="p">:</span> <span class="s1">&#39;gmv&#39;</span><span class="p">,</span> <span class="c1"># if not provided, accuracy would not be computed</span>
        <span class="s1">&#39;cov_denom_name&#39;</span><span class="p">:</span> <span class="s1">&#39;loss&#39;</span><span class="p">,</span>
        <span class="s1">&#39;imp_denom_name&#39;</span><span class="p">:</span> <span class="s1">&#39;gmv&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">raw</span><span class="p">,</span> <span class="n">amt_name</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">rule_params</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">metric_names</span><span class="p">,</span>
    <span class="n">weight_name</span><span class="o">=</span><span class="n">weight_name</span><span class="p">,</span> <span class="n">dcl_dcsn_names</span><span class="o">=</span><span class="n">dcl_dcsn_names</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">rules</span><span class="p">,</span>
    <span class="n">benchmark_name</span><span class="o">=</span><span class="n">benchmark_name</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">col_names</span><span class="o">=</span><span class="n">col_names</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that if some of denominators are not provided, say <code class="docutils literal notranslate"><span class="pre">acc_denom_name</span></code> remains <code class="docutils literal notranslate"><span class="pre">None</span></code>, then accuracy will not be
computed for <code class="docutils literal notranslate"><span class="pre">new_loss</span></code>.</p>
<p>Most use cases should be covered by the above two examples. Sometimes, one may propose a customized metric that cannot
fit into any of existing metric conventions. In this case, some effort is needed for implementation.</p>
<p>To implement, one needs to create a new class of metric inheriting <a class="reference internal" href="metrics.html#report.metrics.BaseMetric" title="report.metrics.BaseMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">report.metrics.BaseMetric</span></code></a>, and
implement customized methods of computing <code class="docutils literal notranslate"><span class="pre">total</span></code>, <code class="docutils literal notranslate"><span class="pre">decline</span></code>, <code class="docutils literal notranslate"><span class="pre">accuracy</span></code>, <code class="docutils literal notranslate"><span class="pre">coverage</span></code>, <code class="docutils literal notranslate"><span class="pre">diff</span></code>, and
<code class="docutils literal notranslate"><span class="pre">impact</span></code>.</p>
<p>Here is an example on how to create a customized metric that focuses on distinct count of a specific column, such as
consumer, or device.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DCNT</span><span class="p">(</span><span class="n">BaseMetric</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot;Distinct count&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dcnt&#39;</span><span class="p">,</span>
    <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rule_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">amt_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">weight_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">base_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">total</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span>
<span class="p">):</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
        <span class="n">rule_name</span><span class="o">=</span><span class="n">rule_name</span><span class="p">,</span>
        <span class="n">amt_name</span><span class="o">=</span><span class="n">amt_name</span><span class="p">,</span>
        <span class="n">weight_name</span><span class="o">=</span><span class="n">weight_name</span><span class="p">,</span>
        <span class="n">base_name</span><span class="o">=</span><span class="n">base_name</span><span class="p">,</span>
        <span class="n">acc_denom_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cov_denom_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">imp_denom_name</span><span class="o">=</span><span class="n">base_name</span><span class="p">,</span>
        <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="n">eps</span>
    <span class="p">)</span>

    <span class="n">_asset_not_none</span><span class="p">({</span><span class="s1">&#39;base_name&#39;</span><span class="p">:</span> <span class="n">base_name</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">compute_total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Total unique number of ``base_name``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">_base_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_val</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_total</span> <span class="o">=</span> <span class="n">_base_val</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">compute_decline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Total unique number of ``base_name`` that is declined</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">_base_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_val</span><span class="p">()</span>
    <span class="n">_dcl_dcsn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dcl_dcsn</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_decline</span> <span class="o">=</span> <span class="n">_base_val</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">_dcl_dcsn</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">compute_impact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Equivalent to ``100. * diff / total``, where</span>
<span class="sd">    ``diff`` is computed by :py:meth:`report.metrics.DCNT.compute_diff`, and</span>
<span class="sd">    ``total`` is computed by :py:meth:`report.metrics.DCNT.compute_total`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The other metric object has different class!&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">compute_base</span><span class="p">()</span>
    <span class="n">_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_diff</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">_impact</span> <span class="o">=</span> <span class="mf">100.</span> <span class="o">*</span> <span class="n">_diff</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_total</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eps</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_impact</span>
</pre></div>
</div>
<p>Note that one does not need to implement the methods that are the same as in <a class="reference internal" href="metrics.html#report.metrics.BaseMetric" title="report.metrics.BaseMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">report.metrics.BaseMetric</span></code></a>.</p>
</div>
<div class="section" id="by-group-analysis">
<h3>By-group analysis<a class="headerlink" href="#by-group-analysis" title="Permalink to this headline"></a></h3>
<p>To conduct by-group analysis, such as performance for each region or customer tenure, one need only specify
<code class="docutils literal notranslate"><span class="pre">group_name</span></code> with the name of the column in the input table indicating groups. Note that for the purpose of
efficiency, the number of groups is not allowed to exceed <a class="reference internal" href="rule_reporter.html#report.rule_reporter.RuleReporter.max_group_num" title="report.rule_reporter.RuleReporter.max_group_num"><code class="xref py py-meth docutils literal notranslate"><span class="pre">report.rule_reporter.RuleReporter.max_group_num()</span></code></a>.
One can adjust the default max group number by initializing <a class="reference internal" href="rule_reporter.html#report.rule_reporter.RuleReporter" title="report.rule_reporter.RuleReporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">report.rule_reporter.RuleReporter</span></code></a> with
the overridden value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reporter</span> <span class="o">=</span> <span class="n">RuleReporter</span><span class="p">(</span><span class="n">max_group_num</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># change to 10</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">raw</span><span class="p">,</span> <span class="n">amt_name</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">rule_params</span><span class="p">,</span> <span class="n">metric_names</span><span class="o">=</span><span class="n">metric_names</span><span class="p">,</span>
    <span class="n">weight_name</span><span class="o">=</span><span class="n">weight_name</span><span class="p">,</span> <span class="n">dcl_dcsn_names</span><span class="o">=</span><span class="n">dcl_dcsn_names</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">rules</span><span class="p">,</span>
    <span class="n">benchmark_name</span><span class="o">=</span><span class="n">benchmark_name</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">col_names</span><span class="o">=</span><span class="n">col_names</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s1">&#39;cust_tenure&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="include_readme.html" class="btn btn-neutral float-left" title="Report - A Tool for Strategy Performance Evaluation and Report" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="rule_reporter.html" class="btn btn-neutral float-right" title="Rule Reporter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>